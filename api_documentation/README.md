# API Documentation

## Path:
```
https://app.pps.land/public-api/v1/<endpoint>
```
## Note:
All requests must be POST requests.
Any other request type will be rejected with error code [405](https://httpstatuses.com/405)

## Request Signing
All API calls must be signed by an API key to be validated.
PHP signing key example:
```PHP
$algo = "sha256";
$data = "data";
$key = "key";
$signature = hash_hmac($algo, $data, $key);
```

## Request Payload
The request payload is of `content-type: form-data`.

### Required Parameters:

`json`: string representation of json data to send to PPS.

The string representation of this `json` parameter is what goes into the `data` variable above to generate the signature.
The `json` parameter should also include a key `userToken` of the value which is set by the Speak PPS Plugin and should be sent with every request.

`orgname`: Organization Name stored by the plugin.

 This is used as a client identifier by PPS.

 `signature`: Signature generated by the API key.

 Here is a cURL example:
 ```bash
 curl -X POST \
  https://app.pps.land/public-api/v1/public-user-login \
  -H 'Cache-Control: no-cache' \
  -H 'Content-Type: application/json' \
  -H 'content-type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW' \
  -F 'json={"userEmail": "testuser","userPassword": "testpassword",  "userToken": "testtoken"}' \
  -F orgname=TestOrg \
  -F signature=4feec9a388bef3fd436be
 ```
You can use [Postman](https://www.getpostman.com/)
or [Insomnia](https://insomnia.rest/) to test requests and get responses from PPS.

 ## Endpoints
The key value pairs may change for certain endpoints below.

### public-user-login
`development status: complete`

Logs in a user.

Required json key value pairs:
```
userEmail
userPassword
userToken
```
Returns on success:
```
message: "Login Success"
data: userEmail
```

### public-user-logout
`development status: complete`

Logs out a user.

Required json key value pairs:
```
userToken
```
Returns on success:
```
message: "Logout Success"
data: None
```

### create-public-user
`development status: complete`

Creates a new user in PPS.

Required json key value pairs:
```
userToken
userEmail
userPassword
validation_url
first_name
last_name
number
unit
street
state
zip
```

After the user is created, an email is sent out to the user to verify their
email address. The email verification is handled by `verify-public-user`.

Returns on success:
```
message: "User created"
data: userEmail
```
### verify-public-user
`development status: complete`

Verifies the user email address.

Required json key value pairs
```
username
orgname
epoch
verification_signature
```
All these key value pairs are part of the
argument list in the url which the user clicks on
to verify themselves.

Returns on success:
```
message: "User verified"
data: True
```

### public-user-password-reset
`development status: complete`

Initiate password reset

Required json key value pairs
```
userEmail
password_reset_url
```
If the user email exists, PPS will send out an
email to the user with the reset link.

Returns on success:
```
message: ""
data: True
```

### finish-public-user-password-reset
`development status: complete`

Resets password

Required json key value pairs
```
username
orgname
epoch
userPassword
verification_signature
```
All these key value pairs, except for `userPassword`,
are part of the argument list in the url
which the user clicks on to verify themselves.

Returns on success:
```
message: "user password reset done"
data: True
```

### create-public-application
`development status: complete`

Create application for user.

Required json key value pairs:
```
userToken
app_parcel
disp_app_type
```
Definitions for `app_parcel` and `disp_app_type` are provided
in the documentation sent via email. Other key value pairs
can be added to this request to record application data,
but the above keys are required.

Returns on success:
```
message: "Application created"
data: {"application_id": <id of the application>}
```
You can provide the application id to the user for
future tracking.

### public-application-upload
`development stats: complete`

Upload files to application.

Required json key value pairs:
```
userToken
application_id (id of the application to which the file is attached)
public_application_upload_type
   - this can be one of:
     - Costs Table
     - Sources and Uses of Funds Table
     - Proof of Funds
     - Files proving Experience
     - Other
```

You will also send a file object with the key `files[]` in the request. Note that this is separate from the json key and doesnt have to be signed. Here is a cURL example of the request:

```bash
curl -X POST \
  http://localhost:5000/public-api/v1/public-application-upload \
  -H 'Cache-Control: no-cache' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -H 'content-type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW' \
  -F 'json={"userToken": "12345", "application_id": "67890", "public_application_upload_type": "Proof of Funds"}' \
  -F orgname=HCLRC \
  -F signature=sigsigsig \
  -F 'files[]=@/Users/anurag/Downloads/112-0005-0090-00.jpg'
```

Returns on success:
```
message: "File uploaded"
data: True
```

### get-public-application-list
`development status: complete`

Get list of applications for user

Required json key value pairs:
```
userToken
```

Returns on success:
```
message: "Applications"
data: <dictionary of applications with relevant data>
```

### submit-public-application
`development status: complete`

Set the status of application as `received`.

Required json key value parameters:
```
userToken
application_id
```

Returns on success:
```
message: "Application Submitted"
data: True
```

### get-public-user-profile
`development status: complete`

Get the details of user.

Required json key value parameters:
```
userToken
```
Returns on success:
```
message: "User profile"
data: <dictonary of user profile values>
```
